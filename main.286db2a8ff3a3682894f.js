(()=>{"use strict";var t={6576:(t,e,s)=>{function i(t){return`on${t.charAt(0).toUpperCase()}${t.slice(1)}`}function a(t,e=null){return e&&localStorage.setItem(t,JSON.stringify(e)),JSON.parse(localStorage.getItem(t))}function r(t,e){return"object"==typeof t&&"object"==typeof e?JSON.stringify(t)===JSON.stringify(e):t===e}function n(t,e,s={max:100,min:0},i=!0){const a=(s.max-s.min)/(e.max-e.min);return i?Math.floor((t-e.min)*a):+((t-e.min)*a).toFixed(2)}function o(t,e=2){if(0===t)return"0 Bytes";const s=e<0?0:e,i=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,i)).toFixed(s))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}function c(t,e){return t.map((t=>t.hashId)).indexOf(e)}function u(t){const e=[...t];let s,i,a=e.length;for(;0!==a;)i=Math.floor(Math.random()*a),a-=1,s=e[a],e[a]=e[i],e[i]=s;return e}class d extends class{constructor(t,e){this.$root=t,this.listeners=e}initListeners(){this.listeners.forEach((t=>{const e=i(t);if(!this[e])throw new Error(`Метод ${e} не определен в компоненте ${this.name}`);this[e]=this[e].bind(this),this.$root.on(t,this[e])}))}removeListeners(){this.listeners.forEach((t=>{const e=i(t);this.$root.off(t,this[e])}))}}{constructor(t,e={}){super(t,e.listeners),this.name=e.name||"DefaultName",this.store=e.store,this.audio=e.audio,this.api=e.api,this.watch=e.watch||[],this.beforeInit()}renderComponent(){throw new Error("Метод renderComponent() должен быть определен")}beforeInit(){}componentDidMount(){}init(){this.initListeners()}destroy(){this.removeListeners()}$storeHasChanged(){}$audioHasChanged(){}isWatching(t){return this.watch.includes(t)}$dispatch(t){this.store.dispatch(t)}$getState(){return this.store.getState()}}class l extends d{constructor(t){super(t,{name:"Header",listeners:[]})}renderComponent(){return"\n      <h1>SoundCloud</h1>\n    "}}var h,p,m;m="header",(p="className")in(h=l)?Object.defineProperty(h,p,{value:m,enumerable:!0,configurable:!0,writable:!0}):h[p]=m;class f{constructor(t){this.$currentElement="string"==typeof t?document.querySelector(t):t}get currentElement(){return this.$currentElement}html(t){return"string"==typeof t?(this.$currentElement.innerHTML=t,this):this.$currentElement.outerHTML.trim()}append(t){t instanceof f&&(t=t.$currentElement),this.$currentElement.append(t)}on(t,e){this.$currentElement.addEventListener(t,e)}off(t,e){this.$currentElement.removeEventListener(t,e)}attr(t,e){return e?(this.$currentElement.setAttribute(t,e),this):this.$currentElement.getAttribute(t)}closest(t){return y(this.$currentElement.closest(t))}find(t){return this.$currentElement.querySelector(t)}coords(){return this.$currentElement.getBoundingClientRect()}css(t={}){return Object.keys(t).forEach((e=>{this.$currentElement.style[e]=t[e]})),this}value(){return this.$currentElement.value}}function y(t){return new f(t)}function g(t,e){return new Promise((s=>{const i=y(t.target),a=y(document.querySelector(`[data-type="${e}"]`)).coords();let r="mousedown"===t.type?t.pageX-a.left:t.touches[0].clientX-a.left;r=v(r,a),document.onmousemove=t=>{r=v(t.pageX-a.left,a),i.css({left:`${r}px`})},document.ontouchmove=t=>{r=v(t.touches[0].clientX-a.left,a),i.css({left:`${r}px`})},document.onmouseup=()=>{document.onmousemove=null,s(r)},document.ontouchend=()=>{document.ontouchstart=null,s(r)}}))}function b(t){return"track"===y(t.target).attr("data-handle")?"track":"volume"===y(t.target).attr("data-handle")?"volume":""}function v(t,e){let s=t;return s>e.width?s=e.width:s<0&&(s=0),s}function $(t="play",e="",s=""){return`\n    <div\n      data-type="button"\n      data-action="${s}"\n      class="button ${e}">\n        <i class="fas fa-${t}"></i>\n    </div>\n  `}y.create=(t="div",e="")=>{const s=document.createElement(t);return e&&s.classList.add(e),y(s)};class _ extends d{constructor(...t){super(...t)}get template(){return JSON.stringify(this.state,null,2)}useState(t={}){this.state={...t}}setState(t){this.state={...this.state,...t},this.reRenderComponent()}reRenderComponent(){this.$root.html(this.template)}}function T(t){return{type:"TOGGLE_PLAY",payload:t}}function S(t){return{type:"SET_IS_REWINDING",payload:t}}function E(t){return{type:"UPDATE_CURRENT_TRACKVOLUME",payload:t}}function k(t){return{type:"SET_IS_FETCHING",payload:t}}function w(t){return{type:"SET_CURRENT_TRACK_ID",payload:t}}function I(t){return{type:"SET_CURRENT_AUDIO_HANDLE_POSITION",payload:t}}function C(t){return{type:"SET_SHUFFLED_TRACK_LIST",payload:t}}class O extends _{constructor(t,e){super(t,{name:"Player",listeners:["mousedown","click","touchstart"],watch:["play","mute","shuffle","repeat","currentAudioHandlePosition","currentTime","isEnded"],...e})}beforeInit(){this.useState()}$storeHasChanged(){}$audioHasChanged({isEnded:t,currentTime:e}){const{isRewinding:s}=this.$getState(),i=y(document.querySelector('[data-type="track-slider"]')).coords().width;if(!s&&this.audio.getState.trackDuration){const t=n(e,{min:0,max:this.audio.getState.trackDuration},{min:0,max:i});this.$dispatch(I(t)),this.$dispatch({type:"SET_CURRENT_AUDIO_TIME_POSITION",payload:e})}t&&this.switchTrack("next")}get template(){return function(t){const e=t.play?$("pause","","play"):$("play","","play"),s=t.shuffle?$("random","button--random active","shuffle"):$("random","button--random","shuffle"),i=t.repeat?$("redo-alt","button--repeat active","repeat"):$("redo-alt","button--repeat","repeat"),a=t.mute?$("volume-mute","","mute"):$("volume-up","","mute"),r=`${n(t.currentTrackVolume,{min:0,max:1},{min:0,max:70},!1)}px`,o=`${t.currentAudioHandlePosition}px`;return`\n    <div class="player__col player__col--first">\n      <div class="player__buttons">\n      ${$("backward","","prev")}\n      ${e}\n      ${$("forward","","next")}\n    </div>\n    <div class="player__track-slider">\n      <div data-type="track-slider" class="track-slider"></div>\n      <div style="left: ${o}" data-handle="track" class="track-handler"></div>\n    </div>\n    </div>\n    <div class="player__col player__col--second">\n      <div class="player__buttons">\n      ${a}\n      <div class="player__volume-slider">\n        <div data-type="volume-slider" class="volume-slider"></div>\n        <div style="left: ${r}" data-handle="volume" class="volume-handler"></div>\n      </div>\n    </div>\n    <div class="player__buttons">\n      ${s}\n      ${i}\n    </div>\n    </div>\n  `}(this.$getState())}renderComponent(){return this.template}onClick(t){if(this.$getState().isFetching)return;const e=y(t.target).closest('[data-type="button"]');if(e.currentElement){const t=e.attr("data-action");switch(t){case"play":this.audio.play(),this.$dispatch(T(this.audio.getState.isPlaying));break;case"mute":this.audio.mute(),this.$dispatch({type:"TOGGLE_MUTE"});break;case"shuffle":this.$getState().shuffle?this.$dispatch(C(this.$getState().trackList)):this.$dispatch(C(u(this.$getState().shuffledTrackList))),this.$dispatch({type:"TOGGLE_SHUFFLE"});break;case"repeat":this.audio.repeat(),this.$dispatch({type:"TOGGLE_REPEAT"});break;case"next":case"prev":this.switchTrack(t)}}}async onMousedown(t){if("track"===b(t)){this.$dispatch(S(!0));const e=y(document.querySelector('[data-type="track-slider"]')),s=n(await g(t,"track-slider"),{min:0,max:e.coords().width},{min:0,max:this.audio.getState.trackDuration||300});this.audio.rewind(s),this.$dispatch(S(!1))}else if("volume"===b(t)){this.$dispatch(S(!0));const e=n(await g(t,"volume-slider"),{min:0,max:70},{min:0,max:1},!1);this.audio.volume(e),this.$dispatch(E(e)),this.$dispatch(S(!1))}}async onTouchstart(t){if("track"===b(t)){this.$dispatch(S(!0));const e=y(document.querySelector('[data-type="track-slider"]')),s=n(await g(t,"track-slider"),{min:0,max:e.coords().width},{min:0,max:this.audio.getState.trackDuration||300});this.audio.rewind(s),this.$dispatch(S(!1))}else if("volume"===b(t)){this.$dispatch(S(!0));const e=n(await g(t,"volume-slider"),{min:0,max:70},{min:0,max:1},!1);this.audio.volume(e),this.$dispatch(E(e)),this.$dispatch(S(!1))}}switchTrack(t){let e=0,s="";this.$dispatch(I(0));const{shuffledTrackList:i,currentTrackId:a,currentTrackVolume:r,currentAudioTimePosition:n,mute:o,repeat:u}=this.$getState(),d=c(i,a),l={currentTime:n,volume:r,muted:o,loop:u};if("next"===t){if(!(d+1<i.length))return!0;e=d+1,s=i[e].hashId,this.$dispatch(w(s)),this.audio.init(i[e].url,l),this.audio.play(),this.$dispatch(T(!0))}else if("prev"===t){if(!(d-1>=0))return!0;e=d-1,s=i[e].hashId,this.$dispatch(w(s)),this.audio.init(i[e].url,l),this.audio.play(),this.$dispatch(T(!0))}}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(O,"className","player");class L{constructor(t){this.audio=t,this.subscribition=null,this.prevState={}}subscribeComponents(t){this.prevState=this.audio.getState,this.subscribition=this.audio.subscribe((e=>{Object.keys(e).forEach((s=>{r(this.prevState[s],e[s])||t.forEach((t=>{if(t.isWatching(s)){const i={[s]:e[s]};t.$audioHasChanged(i)}}))})),this.prevState=this.audio.getState}))}unsubscribeFromAudio(){this.subscribition.unsubscribe()}}class R{constructor(t){this.store=t,this.subscribition=null,this.prevState={}}subscribeComponents(t){this.prevState=this.store.getState(),this.subscribition=this.store.subscribe((e=>{Object.keys(e).forEach((s=>{r(this.prevState[s],e[s])||t.forEach((t=>{if(t.isWatching(s)){const i={[s]:e[s]};t.$storeHasChanged(i),t.reRenderComponent()}}))})),this.prevState=this.store.getState()}))}unsubscribeFromStore(){this.subscribition.unsubscribe()}}class A extends _{constructor(t,e){super(t,{name:"Player",listeners:["click"],watch:["shuffledTrackList","isFetching","play","currentTrackId","searchQuery"],...e})}$storeHasChanged(){}get template(){return function(t){const{shuffledTrackList:e,isFetching:s,currentTrackId:i,play:a,searchQuery:r}=t;if(s)return'\n    <div class="loader">\n      <div class="lds-facebook">\n      <div></div>\n      <div></div>\n      <div></div>\n    </div>\n    </div>\n  ';if(e.length){const t=(n=e,o=r,0===o.length?n:n.filter((t=>t.name.toLowerCase().indexOf(o.toLowerCase())>-1))).map(((t,e)=>function(t,e,s,i){const a=s===t.hashId&&i?"pause":"play",r=(t.hashId,$(`${a}`,"",`${a}`));return`\n    <li\n      data-action="${a}"\n      data-type="track-item"\n      data-id="${t.hashId}"\n      class="track-list__item">\n        ${r}\n      <div class="track-list__number">${e+1}</div>\n      <div class="track-list__name">${t.name}</div>\n      <div class="track-list__size">${t.size}</div>\n    </li>\n\n  `}(t,e,i,a)));return t.length?t.join(""):"По вашему запросу ничего не найдено :("}return"Треков не найдено :(";var n,o}(this.$getState())}renderComponent(){return this.template}onClick(t){const e=y(t.target).closest('[data-type="track-item"]');if(e.currentElement)if("play"===e.attr("data-action")){const{trackList:t,currentTrackId:s,currentTrackVolume:i,mute:a,repeat:r}=this.$getState(),n={volume:i,muted:a,loop:r},o=e.attr("data-id");if(s!==o){this.$dispatch(I(0));const e=c(t,o);this.audio.init(t[e].url,n),this.$dispatch(w(o)),this.$dispatch(T(!0)),this.audio.play()}else this.audio.play(),this.$dispatch(T(!0))}else"pause"===e.attr("data-action")&&(this.audio.play(),this.$dispatch(T(!1)))}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(A,"className","track-list");class x extends _{constructor(t,e){super(t,{name:"Uploader",listeners:["change","click"],watch:["tracksForUpload"],...e})}async fetchData(){this.$dispatch(k(!0));const t=await this.api.getMusicList();if(t.length>0){this.$dispatch({type:"SET_TRACK_LIST",payload:t});const{trackList:e,currentTrackVolume:s,currentTrackId:i,currentAudioTimePosition:a,mute:r,play:n,repeat:o,shuffle:d}=this.$getState();d?this.$dispatch(C(u(t))):this.$dispatch(C(t));const l={currentTime:a,volume:s,muted:r,loop:o,play:n},h=c(e,i);if(-1!==h)this.$dispatch(w(i)),this.audio.init(e[h].url,l);else{const t=e[0].hashId;this.$dispatch(w(t)),this.audio.init(e[0].url,l)}}this.$dispatch(k(!1))}componentDidMount(){this.fetchData()}get template(){return`\n      <div class="uploader__buttons">\n        <input id="file" accept=".mp3,audio/*" multiple="true" type="file" class="uploader__input">\n        <button data-action="open" class="uploader__btn">Открыть</button>\n        <button data-action ="upload" class="uploader__btn">Загрузить на сервер</button>\n      </div>\n      ${t=this.$getState().tracksForUpload,t.length?`\n      <ul class="uploader__files-list">\n        ${t.map(((t,e)=>{const s=100===t.uploadProgress?"background-color: green;":"";return`\n      <li class="list-item">\n        <div class="list-item__info">${e+1} ${t.file.name}</div>\n        <div class="list-item__progress">\n          <div style="${s} width: ${t.uploadProgress||0}%" data-id="${e}" class="progress-bar"></div>\n        </div>\n      </li>`})).join("")}\n      </ul>\n    `:""}\n    `;var t}renderComponent(){return this.template}onChange(t){if(!t.target.files.length)return;const e=Array.from(t.target.files),s=e.map((t=>({file:t,uploadProgress:0})));e.forEach((t=>{t.type.match("audio")?this.$dispatch({type:"UPDATE_TRACKS_FOR_UPLOAD",payload:s}):alert("Не музыка")}))}async onClick(t){const e=y(t.target),s=e.closest(".uploader");if("open"===e.attr("data-action"))s.find("input").click();else if("upload"===e.attr("data-action")){const{tracksForUpload:t}=this.$getState();t.forEach(((t,e)=>{const s=this.api.put(t.file);s.on("state-change",(t=>{const s=t.bytesTransferred/t.totalBytes*100;this.$dispatch({type:"SET_UPLOAD_PROGRESS",payload:{idx:e,percentage:s}})}),(t=>{console.log(`Some ${t} has occured`)}),(async()=>{const{name:t,size:e,md5Hash:i}=await s.snapshot.ref.getMetadata(),a=await s.snapshot.ref.getDownloadURL();await this.api.findTrackByHashId(i)||this.api.createCollectionRecord(i,t,a,e),this.fetchData()}))}))}}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(x,"className","uploader");var P=s(2671);s(3028),s(9933),s(8274);class U extends _{constructor(t,e){super(t,{name:"Searchbar",watch:[],listeners:["input"],...e})}get template(){return function(t){const{searchQuery:e}=t;return`\n    <div class="searchbar__input">\n      <input value="${e}" placeholder="Поиск..." type="text">\n      <button data-action="search" class="searchbar__btn">\n        <i class="fas fa-search"></i>\n      </button>\n    </div>\n  `}(this.$getState())}renderComponent(){return this.template}onInput(t){const e=y(t.target);this.$dispatch({type:"SET_SEARCH_QUERY",payload:e.value()})}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(U,"className","searchbar");const D=function(t={},e){let s=e({...t},{type:"__INIT__"}),i=[];return{subscribe:t=>(i.push(t),{unsubscribe(){i=i.filter((e=>e!==t))}}),dispatch(t){s=e(s,t),i.forEach((t=>t(s)))},getState:()=>s}}((N=a("sound-cloud"))?(t=>({...t,play:!1,isFetching:!0,isRewinding:!1,tracksForUpload:[],trackList:[],shuffledTrackList:[],searchQuery:""}))(N):{trackList:[],shuffledTrackList:[],play:!1,mute:!1,shuffle:!1,repeat:!1,currentTrackVolume:1,currentTrackId:null,isRewinding:!1,tracksForUpload:[],isFetching:!0,currentAudioTimePosition:0,currentAudioHandlePosition:0,searchQuery:""},(function(t,e){let s;switch(e.type){case"TOGGLE_SHUFFLE":return s=t.shuffle,{...t,shuffle:!s};case"TOGGLE_PLAY":return{...t,play:e.payload};case"TOGGLE_MUTE":return s=t.mute,{...t,mute:!s};case"TOGGLE_REPEAT":return s=t.repeat,{...t,repeat:!s};case"UPDATE_CURRENT_TRACKVOLUME":return{...t,currentTrackVolume:e.payload};case"SET_IS_REWINDING":return{...t,isRewinding:e.payload};case"UPDATE_TRACKS_FOR_UPLOAD":return{...t,tracksForUpload:e.payload};case"SET_UPLOAD_PROGRESS":const{idx:i,percentage:a}=e.payload,r=t.tracksForUpload.map(((t,e)=>e===i?Object.assign({},t,{uploadProgress:a}):t));return{...t,tracksForUpload:r};case"SET_TRACK_LIST":return{...t,trackList:e.payload};case"SET_IS_FETCHING":return{...t,isFetching:e.payload};case"SET_CURRENT_TRACK_ID":return{...t,currentTrackId:e.payload};case"SET_CURRENT_AUDIO_TIME_POSITION":return{...t,currentAudioTimePosition:e.payload};case"SET_CURRENT_AUDIO_HANDLE_POSITION":return{...t,currentAudioHandlePosition:e.payload};case"SET_SHUFFLED_TRACK_LIST":return{...t,shuffledTrackList:e.payload};case"SET_SEARCH_QUERY":return{...t,searchQuery:e.payload};default:return t}}));var N;const F=new class{constructor(){this.subscribers=[],this.audio=new Audio}get getState(){return JSON.parse(JSON.stringify({isPlaying:!this.audio.paused,isMuted:this.audio.muted,isLopped:this.audio.loop,isEnded:this.audio.ended,currentTime:Math.floor(this.audio.currentTime)||0,currentVolume:this.audio.volume,readyState:this.audio.readyState,trackDuration:this.audio.duration||0}))}subscribe(t){return this.subscribers.push(t),{unsubscribe(){this.subscribers=this.subscribers.filter((e=>e!==t))}}}emit(t){this.subscribers.forEach((e=>e(t)))}init(t,e){this.audio.currentTime=e.currentTime||0,this.audio.volume=e.volume||1,this.audio.muted=e.muted||!1,this.audio.loop=e.loop||!1,this.audio.src=t,this.audio.ontimeupdate=()=>this.emit(this.getState),this.audio.onended=()=>this.emit(this.getState)}play(){this.audio.paused?this.audio.play():this.audio.pause(),this.emit(this.getState)}rewind(t=0){this.audio.currentTime=t,this.emit(this.getState)}volume(t=1){this.audio.volume=t,this.emit(this.getState)}mute(){this.audio.muted?this.audio.muted=!1:this.audio.muted=!0,this.emit(this.getState)}repeat(){this.audio.loop?this.audio.loop=!1:this.audio.loop=!0,this.emit(this.getState)}},H=new class{constructor(t={}){P.Z.initializeApp(t),this.storage=P.Z.storage()}put(t){return this.storage.ref(`music/${t.name}`).put(t)}async getAllUsers(){try{const t=(await P.Z.firestore().collection("users").get()).docs.map((t=>({...t.data()})));return console.log("All Users",t),t}catch(t){console.log(`Some error ${t} has occured in getMusicList()`)}}async getMusicList(){try{return(await P.Z.firestore().collection("music").get()).docs.map((t=>({...t.data()})))}catch(t){return console.error(`Ошибка в методе getMusicList()\n\n${t.message}`),!1}}async createCollectionRecord(t,e,s,i){try{await P.Z.firestore().collection("music").add({name:e,url:s,size:o(i),hashId:t})}catch(t){console.error(`Ошибка в методе createCollectionRecord()\n\n${t.message}`)}}async findTrackByHashId(t){try{if((await P.Z.firestore().collection("music").where("hashId","==",`${t}`).get()).docs.map((t=>({...t.data()}))).length>0)throw new Error("Трек с таким hashId уже существует!");return!1}catch(t){return console.error(`Ошибка в методе findTrackByHashId()\n\n${t.message}`),!0}}}({apiKey:"AIzaSyDQIYGDohT6X5ckVKEwkOH91p_VLurr-04",authDomain:"sound-cloud-408fc.firebaseapp.com",projectId:"sound-cloud-408fc",storageBucket:"sound-cloud-408fc.appspot.com",messagingSenderId:"360477666381",appId:"1:360477666381:web:143ac502ef8a5b1b93c004"});D.subscribe((t=>a("sound-cloud",t))),new class{constructor(t,e={}){this.$rootElement=y(t),this.components=e.components||[],this.store=e.store,this.audio=e.audio,this.storeObserver=new R(this.store),this.audioObserver=new L(this.audio),this.api=e.firebase}init(){const t=y.create("div","soundcloud"),e={store:this.store,audio:this.audio,api:this.api};return this.components=this.components.map((s=>{const i=y.create("div",s.className),a=new s(i,e);return i.html(a.renderComponent()),t.append(i),a})),this.$rootElement.append(t),this.components.forEach((t=>t.componentDidMount())),this.storeObserver.subscribeComponents(this.components),this.audioObserver.subscribeComponents(this.components),this.components.forEach((t=>t.init())),!0}destroy(){return this.storeObserver.unsubscribeFromStore(),this.audioObserver.unsubscribeFromAudio(),this.components.forEach((t=>t.destroy())),!0}}("#root",{components:[l,O,x,U,A],store:D,audio:F,firebase:H}).init()}},e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={exports:{}};return t[i](a,a.exports,s),a.exports}s.m=t,s.x=t=>{},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={179:0},e=[[1202,532],[6576,532]],i=t=>{},a=(a,r)=>{for(var n,o,[c,u,d,l]=r,h=0,p=[];h<c.length;h++)o=c[h],s.o(t,o)&&t[o]&&p.push(t[o][0]),t[o]=0;for(n in u)s.o(u,n)&&(s.m[n]=u[n]);for(d&&d(s),a&&a(r);p.length;)p.shift()();return l&&e.push.apply(e,l),i()},r=self.webpackChunk=self.webpackChunk||[];function n(){for(var i,a=0;a<e.length;a++){for(var r=e[a],n=!0,o=1;o<r.length;o++){var c=r[o];0!==t[c]&&(n=!1)}n&&(e.splice(a--,1),i=s(s.s=r[0]))}return 0===e.length&&(s.x(),s.x=t=>{}),i}r.forEach(a.bind(null,0)),r.push=a.bind(null,r.push.bind(r));var o=s.x;s.x=()=>(s.x=o||(t=>{}),(i=n)())})(),s.x()})();